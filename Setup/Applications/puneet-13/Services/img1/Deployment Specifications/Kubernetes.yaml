harnessApiVersion: '1.0'
type: KUBERNETES
advancedConfig: |
  # Enter your Controller YAML spec below.
  #
  # Supported Controllers:
  #   ReplicationController
  #   Deployment
  #   ReplicaSet
  #   StatefulSet
  #   DaemonSet
  #
  # Placeholders:
  #
  # Required: ${DOCKER_IMAGE_NAME}
  #   - Replaced with the Docker image name and tag
  #
  # Optional: ${CONTAINER_NAME}
  #   - Replaced with a container name based on the image name
  #
  # Optional: ${CONFIG_MAP_NAME}
  #   - Replaced with the ConfigMap name (same as controller name)
  #     Config map contains all unencrypted service variables and
  #     all unencrypted config files, unless a custom
  #     config map is provided
  #
  # Optional: ${SECRET_MAP_NAME}
  #   - Replaced with the Secret name (same as controller name)
  #     Secret map contains all encrypted service variables and
  #     all encrypted config files
  #
  # Optional: ${SECRET_NAME}
  #   - Replaced with the name of the generated image pull
  #     secret when pulling from a private Docker registry
  #
  # Harness will set the controller name, namespace,
  # selector labels, and number of replicas.
  #
  # Service variables will be merged into environment
  # variables for all containers, overriding values if
  # the name is the same.
  #
  # ---
  apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    name: web
  spec:
    selector:
      matchLabels:
        app: nginx # has to match .spec.template.metadata.labels
    serviceName: "nginx"
    replicas: 3 # by default is 1
    template:
      metadata:
        labels:
          app: nginx # has to match .spec.selector.matchLabels
      spec:
        terminationGracePeriodSeconds: 10
        containers:
        - name: nginx
          image: ${DOCKER_IMAGE_NAME}
          ports:
          - containerPort: 80
            name: web
